# ==============================================================================
# PostgreSQL Backup Manager - Environment Configuration
# ==============================================================================
# Copy this file to .env and update with your actual values
# ==============================================================================

# ==============================================================================
# DATABASE CONFIGURATION (REQUIRED)
# ==============================================================================
# PostgreSQL database connection details
# These settings are REQUIRED for the application to work

# Database host (hostname or IP address)
# Examples:
#   - Supabase: db.xxxxxxxxxxxxx.supabase.co
#   - AWS RDS: mydb.123456789.us-east-1.rds.amazonaws.com
#   - Local: localhost
DB_HOST=db.example.com

# Database port (default PostgreSQL port is 5432)
DB_PORT=5432

# Database username
DB_USER=postgres

# Database password (keep this secure!)
DB_PASSWORD=your_secure_password_here

# Database name
DB_NAME=postgres

# Database schema to backup (Optional)
# Leave empty to backup all schemas
# Example: public
DB_SCHEMA=

# Tables to exclude from backup (Optional)
# Comma-separated list of table names
# Useful for excluding migration tables, cache tables, etc.
# If schema is specified, just use table names (schema will be prepended automatically)
# Examples: migrations,sessions,cache
DB_EXCLUDE_TABLES=

# SSL mode for database connections (on/off)
# Set to 'on' when your PostgreSQL server requires SSL (e.g., cloud-hosted databases)
# Set to 'off' when your server does not support SSL
DB_SSL=off


# ==============================================================================
# BACKUP CONFIGURATION
# ==============================================================================

# Enable automatic scheduled backups (true/false)
# If true, backups will be created automatically based on BACKUP_SCHEDULE
BACKUP_AUTO=false

# Cron schedule for automatic backups
# Format: minute hour day month weekday
# Examples:
#   - Every day at 2 AM:        0 2 * * *
#   - Every 6 hours:            0 */6 * * *
#   - Every Sunday at midnight: 0 0 * * 0
#   - Every 30 minutes:         */30 * * * *
#   - First day of month:       0 0 1 * *
BACKUP_SCHEDULE=0 2 * * *

# Number of days to keep backups (older backups will be deleted automatically)
# This applies to both local and remote backups
BACKUP_RETENTION_DAYS=7

# Storage mode: where to save backups
# Options:
#   - local:  Save backups only to local filesystem
#   - remote: Upload backups only to S3-compatible storage
#   - both:   Save locally AND upload to remote storage
BACKUP_STORAGE=local

# Local backup directory path
# For Docker: /app/backups (mapped to volume)
# For local: ./backups or any absolute path
BACKUP_LOCAL_PATH=./backups

# Backup format: sql (plain text) or dump (compressed custom format)
# sql: Plain text, human-readable, can be edited
# dump: Compressed binary format, faster restore, smaller size
BACKUP_FORMAT=sql


# ==============================================================================
# S3-COMPATIBLE STORAGE CONFIGURATION (OPTIONAL)
# ==============================================================================
# Required only if BACKUP_STORAGE=remote or BACKUP_STORAGE=both
# Supports: AWS S3, Supabase Storage, MinIO, DigitalOcean Spaces, Backblaze B2, etc.

# S3 Access Key ID
AWS_ACCESS_KEY_ID=your_access_key_id_here

# S3 Secret Access Key (keep this secure!)
AWS_SECRET_ACCESS_KEY=your_secret_access_key_here

# S3 Region
# Examples:
#   - AWS: us-east-1, us-west-2, eu-central-1, ap-southeast-1
#   - For Supabase/MinIO: can be any value, often us-east-1
AWS_REGION=us-east-1

# S3 Bucket Name
# The bucket must exist before using the application
AWS_S3_BUCKET=postgres-backups

# S3 Folder Path / Prefix (Optional)
# Organize backups in nested folders within your bucket
# Examples:
#   - backups/postgres
#   - production/databases/postgres
#   - my-app/db-backups
# Leave empty to save backups in the root of the bucket
AWS_S3_PREFIX=

# Custom S3 Endpoint (Optional - leave empty for AWS S3)
# Required for S3-compatible services like Supabase, MinIO, DigitalOcean Spaces
# Examples:
#   - Supabase: https://your-project-id.supabase.co/storage/v1/s3
#   - MinIO: http://localhost:9000
#   - DigitalOcean: https://nyc3.digitaloceanspaces.com
#   - Backblaze: https://s3.us-west-002.backblazeb2.com
#   - AWS S3: (leave empty)
AWS_S3_ENDPOINT=

# Force path-style S3 URLs (true/false)
# Set to true for:
#   - Supabase Storage
#   - MinIO
#   - Some S3-compatible services
# Set to false for:
#   - AWS S3 (standard)
#   - DigitalOcean Spaces
AWS_S3_FORCE_PATH_STYLE=false


# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================

# Port for the web application
# Default: 7050
PORT=7050

# Node environment
# Options: development, production
# In production mode, more optimizations are enabled
NODE_ENV=production

# Log level
# Options: error, warn, info, http, verbose, debug, silly
# Default: info
# - error: Only error messages
# - warn: Warnings and errors
# - info: General information, warnings, and errors (recommended for production)
# - debug: Detailed debugging information (recommended for development)
LOG_LEVEL=info

# Configuration mode
# Options: env, manual
# env: Configuration loaded from environment variables (this file)
#      Changes require application restart
#      Best for production with infrastructure-as-code
# manual: Configuration set via API calls at runtime
#         Changes take effect immediately without restart
#         Stored in memory (resets on application restart)
#         Best for development or testing
CONFIG_MODE=env


# ==============================================================================
# EXAMPLE CONFIGURATIONS
# ==============================================================================

# -------------------------------
# Example 1: AWS S3 Configuration
# -------------------------------
# BACKUP_STORAGE=both
# AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
# AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
# AWS_REGION=us-east-1
# AWS_S3_BUCKET=my-postgres-backups
# AWS_S3_PREFIX=backups/postgres
# AWS_S3_ENDPOINT=
# AWS_S3_FORCE_PATH_STYLE=false

# -------------------------------
# Example 2: Supabase Storage Configuration
# -------------------------------
# BACKUP_STORAGE=both
# AWS_ACCESS_KEY_ID=your_supabase_access_key_id
# AWS_SECRET_ACCESS_KEY=your_supabase_secret_key
# AWS_REGION=us-east-1
# AWS_S3_BUCKET=backups
# AWS_S3_PREFIX=postgres-backups
# AWS_S3_ENDPOINT=https://xxxxxxxxxxxxx.supabase.co/storage/v1/s3
# AWS_S3_FORCE_PATH_STYLE=true

# -------------------------------
# Example 3: MinIO Configuration
# -------------------------------
# BACKUP_STORAGE=both
# AWS_ACCESS_KEY_ID=minioadmin
# AWS_SECRET_ACCESS_KEY=minioadmin
# AWS_REGION=us-east-1
# AWS_S3_BUCKET=postgres-backups
# AWS_S3_PREFIX=production/db
# AWS_S3_ENDPOINT=http://localhost:9000
# AWS_S3_FORCE_PATH_STYLE=true

# -------------------------------
# Example 4: DigitalOcean Spaces Configuration
# -------------------------------
# BACKUP_STORAGE=both
# AWS_ACCESS_KEY_ID=your_do_spaces_key
# AWS_SECRET_ACCESS_KEY=your_do_spaces_secret
# AWS_REGION=nyc3
# AWS_S3_BUCKET=my-backups
# AWS_S3_PREFIX=databases/postgres
# AWS_S3_ENDPOINT=https://nyc3.digitaloceanspaces.com
# AWS_S3_FORCE_PATH_STYLE=false

# -------------------------------
# Example 5: Local-Only Configuration
# -------------------------------
# BACKUP_STORAGE=local
# BACKUP_AUTO=true
# BACKUP_SCHEDULE=0 2 * * *
# BACKUP_RETENTION_DAYS=7
# BACKUP_LOCAL_PATH=./backups
# BACKUP_FORMAT=sql
# DB_SCHEMA=public
# DB_EXCLUDE_TABLES=migrations,sessions,cache

# ==============================================================================
# SECURITY NOTES
# ==============================================================================
# 1. NEVER commit .env file to version control
# 2. Keep AWS_SECRET_ACCESS_KEY and DB_PASSWORD secure
# 3. Use strong passwords and rotate credentials regularly
# 4. Limit S3 bucket permissions to minimum required
# 5. Consider encrypting backups for sensitive data
# 6. Use firewall rules to restrict network access
# 7. Enable HTTPS in production with reverse proxy

# ==============================================================================
# TROUBLESHOOTING
# ==============================================================================
# - Connection issues: Verify DB_HOST, DB_PORT, and firewall rules
# - S3 upload fails: Check AWS credentials and bucket permissions
# - IPv6 issues (Supabase): Run application outside Docker
# - Permission errors: Check BACKUP_LOCAL_PATH permissions
# - Scheduler not running: Verify BACKUP_AUTO=true and valid cron schedule
